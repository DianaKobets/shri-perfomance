<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Яндекс.Дом</title>
    <link rel="stylesheet" href="main.min.css" />
  </head>
  <body>
    <div id="app"></div>
    <script>
      (function () {
        // Данные для вкладок
        const TABS = {
          all: {
            title: "Все",
            items: [
              {
                icon: "light2",
                iconLabel: "Освещение",
                title: "Xiaomi Yeelight LED Smart Bulb",
                subtitle: "Включено",
              },
              {
                icon: "light",
                iconLabel: "Освещение",
                title: "D-Link Omna 180 Cam",
                subtitle: "Включится в 17:00",
              },
              {
                icon: "temp",
                iconLabel: "Температура",
                title: "Elgato Eve Degree Connected",
                subtitle: "Выключено до 17:00",
              },
              {
                icon: "light",
                iconLabel: "Освещение",
                title: "LIFX Mini Day & Dusk A60 E27",
                subtitle: "Включится в 17:00",
              },
              {
                icon: "light2",
                iconLabel: "Освещение",
                title: "Xiaomi Mi Air Purifier 2S",
                subtitle: "Включено",
              },
              {
                icon: "light",
                iconLabel: "Освещение",
                title: "Philips Zhirui",
                subtitle: "Включено",
              },
              {
                icon: "light",
                iconLabel: "Освещение",
                title: "Philips Zhirui",
                subtitle: "Включено",
              },
              {
                icon: "light2",
                iconLabel: "Освещение",
                title: "Xiaomi Mi Air Purifier 2S",
                subtitle: "Включено",
              },
            ],
          },
          kitchen: {
            title: "Кухня",
            items: [
              {
                icon: "light2",
                iconLabel: "Освещение",
                title: "Xiaomi Yeelight LED Smart Bulb",
                subtitle: "Включено",
              },
              {
                icon: "temp",
                iconLabel: "Температура",
                title: "Elgato Eve Degree Connected",
                subtitle: "Выключено до 17:00",
              },
            ],
          },
          hall: {
            title: "Зал",
            items: [
              {
                icon: "light",
                iconLabel: "Освещение",
                title: "Philips Zhirui",
                subtitle: "Выключено",
              },
              {
                icon: "light2",
                iconLabel: "Освещение",
                title: "Xiaomi Mi Air Purifier 2S",
                subtitle: "Выключено",
              },
            ],
          },
          lights: {
            title: "Лампочки",
            items: [
              {
                icon: "light",
                iconLabel: "Освещение",
                title: "D-Link Omna 180 Cam",
                subtitle: "Включится в 17:00",
              },
              {
                icon: "light",
                iconLabel: "Освещение",
                title: "LIFX Mini Day & Dusk A60 E27",
                subtitle: "Включится в 17:00",
              },
              {
                icon: "light2",
                iconLabel: "Освещение",
                title: "Xiaomi Mi Air Purifier 2S",
                subtitle: "Включено",
              },
              {
                icon: "light",
                iconLabel: "Освещение",
                title: "Philips Zhirui",
                subtitle: "Включено",
              },
            ],
          },
          cameras: {
            title: "Камеры",
            items: [
              {
                icon: "light2",
                iconLabel: "Освещение",
                title: "Xiaomi Mi Air Purifier 2S",
                subtitle: "Включено",
              },
            ],
          },
        };
        for (let i = 0; i < 6; ++i) {
          TABS.all.items = [...TABS.all.items, ...TABS.all.items];
        }
        const TABS_KEYS = Object.keys(TABS);

        // Функция для создания HTML элемента события
        function createEventHTML(props) {
          const { icon, iconLabel, title, subtitle, slim } = props;
          return `
          <li class="event${slim ? " event_slim" : ""}">
            <button class="event__button">
              <span class="event__icon event__icon_${icon}" role="img" aria-label="${iconLabel}"></span>
              <h4 class="event__title">${title}</h4>
              ${
                subtitle
                  ? `<span class="event__subtitle">${subtitle}</span>`
                  : ""
              }
            </button>
          </li>
        `;
        }

        // HTML для заголовка
        function renderHeader() {
          return `
          <header class="header">
            <a href="/" class="header__logo" aria-label="Яндекс.Дом"></a>
            <button class="header__menu" aria-expanded="false">
              <span class="header__menu-text a11y-hidden">Открыть меню</span>
            </button>
            <ul class="header__links">
              <li class="header__item">
                <a class="header__link header__link_current" href="/" aria-current="page">Сводка</a>
              </li>
              <li class="header__item">
                <a class="header__link" href="/devices">Устройства</a>
              </li>
              <li class="header__item">
                <a class="header__link" href="/scripts">Сценарии</a>
              </li>
            </ul>
          </header>
        `;
        }

        // HTML для секции "Главное"
        function renderGeneralSection() {
          return `
          <section class="section main__general">
            <h2 class="section__title section__title-header section__main-title">Главное</h2>
            <div class="hero-dashboard">
              <div class="hero-dashboard__primary">
                <h3 class="hero-dashboard__title">Привет, Геннадий!</h3>
                <p class="hero-dashboard__subtitle">Двери и окна закрыты, сигнализация включена.</p>
                <ul class="hero-dashboard__info">
                  <li class="hero-dashboard__item">
                    <div class="hero-dashboard__item-title">Дома</div>
                    <div class="hero-dashboard__item-details">+23<span class="a11y-hidden">°</span></div>
                  </li>
                  <li class="hero-dashboard__item">
                    <div class="hero-dashboard__item-title">За окном</div>
                    <div class="hero-dashboard__item-details">
                      +19<span class="a11y-hidden">°</span>
                      <div class="hero-dashboard__icon hero-dashboard__icon_rain" role="img" aria-label="Дождь"></div>
                    </div>
                  </li>
                </ul>
              </div>
              <ul class="hero-dashboard__schedule">
                ${createEventHTML({
                  icon: "temp",
                  iconLabel: "Температура",
                  title: "Philips Cooler",
                  subtitle: "Начнет охлаждать в 16:30",
                })}
                ${createEventHTML({
                  icon: "light",
                  iconLabel: "Освещение",
                  title: "Xiaomi Yeelight LED Smart Bulb",
                  subtitle: "Включится в 17:00",
                })}
                ${createEventHTML({
                  icon: "light",
                  iconLabel: "Освещение",
                  title: "Xiaomi Yeelight LED Smart Bulb",
                  subtitle: "Включится в 17:00",
                })}
              </ul>
            </div>
          </section>
        `;
        }

        // HTML для секции "Избранные сценарии"
        function renderScriptsSection() {
          return `
          <section class="section main__scripts">
            <h2 class="section__title section__title-header">Избранные сценарии</h2>
            <ul class="event-grid">
              ${createEventHTML({
                slim: true,
                icon: "light2",
                iconLabel: "Освещение",
                title: "Выключить весь свет в доме и во дворе",
              })}
              ${createEventHTML({
                slim: true,
                icon: "schedule",
                iconLabel: "Расписание",
                title: "Я ухожу",
              })}
              ${createEventHTML({
                slim: true,
                icon: "light2",
                iconLabel: "Освещение",
                title: "Включить свет в коридоре",
              })}
              ${createEventHTML({
                slim: true,
                icon: "temp2",
                iconLabel: "Температура",
                title: "Набрать горячую ванну",
                subtitle: "Начнётся в 18:00",
              })}
              ${createEventHTML({
                slim: true,
                icon: "temp2",
                iconLabel: "Температура",
                title: "Сделать пол тёплым во всей квартире",
              })}
            </ul>
          </section>
        `;
        }

        // HTML для секции "Избранные устройства"
        function renderDevicesSection() {
          const activeTab =
            new URLSearchParams(window.location.search).get("tab") || "all";
          let selectOptions = "";
          let tabsHTML = "";
          let panelsHTML = "";

          TABS_KEYS.forEach((key) => {
            selectOptions += `<option value="${key}" ${
              key === activeTab ? "selected" : ""
            }>${TABS[key].title}</option>`;
            tabsHTML += `
            <li role="tab" aria-selected="${
              key === activeTab ? "true" : "false"
            }" tabindex="${
              key === activeTab ? "0" : "-1"
            }" class="section__tab${
              key === activeTab ? " section__tab_active" : ""
            }" id="tab_${key}" aria-controls="panel_${key}">
              ${TABS[key].title}
            </li>
          `;
            const itemsHTML = TABS[key].items
              .map((item) => createEventHTML(item))
              .join("");
            panelsHTML += `
            <div role="tabpanel" class="section__panel${
              key === activeTab ? "" : " section__panel_hidden"
            }" aria-hidden="${
              key === activeTab ? "false" : "true"
            }" id="panel_${key}" aria-labelledby="tab_${key}">
              <ul class="section__panel-list">${itemsHTML}</ul>
            </div>
          `;
          });

          return `
          <section class="section main__devices">
            <div class="section__title">
              <h2 class="section__title-header">Избранные устройства</h2>
              <select class="section__select">${selectOptions}</select>
              <ul role="tablist" class="section__tabs">${tabsHTML}</ul>
            </div>
            <div class="section__panel-wrapper">${panelsHTML}</div>
          </section>
        `;
        }

        // Сборка всего HTML
        function renderApp() {
          const app = document.getElementById("app");
          app.innerHTML = `
          ${renderHeader()}
          <main class="main">
            ${renderGeneralSection()}
            ${renderScriptsSection()}
            ${renderDevicesSection()}
          </main>
        `;

          // Добавление обработчиков событий
          addEventListeners();
        }

        // Функция для добавления обработчиков событий
        function addEventListeners() {
          // Обработчик для кнопки меню
          const menuButton = document.querySelector(".header__menu");
          const menuLinks = document.querySelector(".header__links");
          let expanded = false;
          menuButton.addEventListener("click", () => {
            expanded = !expanded;
            menuButton.setAttribute("aria-expanded", expanded);
            menuButton.querySelector(".header__menu-text").textContent =
              expanded ? "Закрыть меню" : "Открыть меню";
            menuLinks.classList.toggle("header__links_opened", expanded);
          });

          // Обработчик для выбора вкладки через select
          const select = document.querySelector(".section__select");
          select.addEventListener("change", (event) => {
            setActiveTab(event.target.value);
          });

          // Обработчик для клика по вкладкам
          const tabs = document.querySelectorAll(".section__tab");
          tabs.forEach((tab) => {
            tab.addEventListener("click", () => {
              setActiveTab(tab.id.replace("tab_", ""));
            });
          });

          // Обработчик для стрелки прокрутки
          const panelWrapper = document.querySelector(
            ".section__panel-wrapper"
          );
          const arrow = document.createElement("div");
          arrow.className = "section__arrow";
          arrow.addEventListener("click", () => {
            const activePanel = panelWrapper.querySelector(
              ".section__panel:not(.section__panel_hidden)"
            );
            if (activePanel) {
              activePanel.scrollBy({ left: 400, behavior: "smooth" });
            }
          });
          panelWrapper.appendChild(arrow);

          // Проверка необходимости стрелки прокрутки
          function checkScroll() {
            const activePanel = panelWrapper.querySelector(
              ".section__panel:not(.section__panel_hidden)"
            );
            if (activePanel) {
              const hasRightScroll =
                activePanel.scrollWidth > activePanel.clientWidth;
              arrow.style.display = hasRightScroll ? "block" : "none";
            }
          }

          // Функция для установки активной вкладки
          function setActiveTab(key) {
            tabs.forEach((t) => {
              const isActive = t.id === `tab_${key}`;
              t.setAttribute("aria-selected", isActive);
              t.classList.toggle("section__tab_active", isActive);
              t.tabIndex = isActive ? 0 : -1;
            });
            const panels = document.querySelectorAll(".section__panel");
            panels.forEach((p) => {
              const isActive = p.id === `panel_${key}`;
              p.classList.toggle("section__panel_hidden", !isActive);
              p.setAttribute("aria-hidden", !isActive);
            });
            select.value = key;
            checkScroll();
          }

          // Инициализация
          checkScroll();
        }

        // Рендеринг приложения
        renderApp();
      })();
    </script>
  </body>
</html>
